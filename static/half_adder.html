<!DOCTYPE html>
<html>
<head>
    <title>Turing Game - Half Adder</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module">
        import init, { xor_gate, and_gate, toggle_transistor } from "./pkg/transistor_game.js";

        document.addEventListener("DOMContentLoaded", function() {
        fetch("sidebar.html")
            .then(response => response.text())
            .then(data => {
                document.getElementById("sidebar-container").innerHTML = data;
            });
        });

        async function run() {
            console.log('Initializing WebAssembly module');
            await init();
            console.log('WebAssembly module initialized');

            const inputA = document.getElementById("inputA");
            const inputB = document.getElementById("inputB");
            const sum = document.getElementById("sum");
            const carry = document.getElementById("carry");

            console.log('Elements:', { inputA, inputB, sum, carry });

            let stateA = false;
            let stateB = false;

            if (inputA) {
                inputA.addEventListener("click", () => {
                    console.log('Input A clicked');
                    stateA = toggle_transistor(stateA);
                    inputA.classList.toggle("on", stateA);
                    inputA.textContent = stateA ? "1" : "0";
                    updateOutput();
                });
            } else {
                console.error('inputA element not found');
            }

            if (inputB) {
                inputB.addEventListener("click", () => {
                    console.log('Input B clicked');
                    stateB = toggle_transistor(stateB);
                    inputB.classList.toggle("on", stateB);
                    inputB.textContent = stateB ? "1" : "0";
                    updateOutput();
                });
            } else {
                console.error('inputB element not found');
            }

            function updateOutput() {
                const sumResult = xor_gate(stateA, stateB);
                const carryResult = and_gate(stateA, stateB);
                sum.classList.toggle("on", sumResult);
                sum.textContent = sumResult ? "1" : "0";
                carry.classList.toggle("on", carryResult);
                carry.textContent = carryResult ? "1" : "0";
                console.log(`Sum updated: ${sumResult}, Carry updated: ${carryResult}`);
            }
        }

        run();
    </script>
</head>
<body>
    <div id="sidebar-container"></div>
    <div class="content">
        <h1>Half Adder</h1>
        <h3>What is a Half Adder?</h3>
        <p>A Half Adder is a combinational circuit that performs the addition of two single-bit binary numbers (A and B). It has two outputs: Sum and Carry. The Sum represents the least significant bit of the addition result, while the Carry represents the carry-out bit.</p>
        <p>Try the Half Adder by toggling the two inputs below. The Sum and Carry outputs will update accordingly:</p>
        <div id="inputA" class="transistor">0</div>
        <div id="inputB" class="transistor">0</div>
        <div>Sum:</div>
        <div id="sum" class="transistor">0</div>
        <div>Carry:</div>
        <div id="carry" class="transistor">0</div>
    </div>
</body>
</html>
