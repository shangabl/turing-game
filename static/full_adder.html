<!DOCTYPE html>
<html>
<head>
    <title>Turing Game - Full Adder</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="sidebar-container"></div>
    <div class="content">
        <h1>Full Adder</h1>
        <h3>What is a Full Adder?</h3>
        <p>A Full Adder is a combinational circuit that performs the addition of three single-bit binary numbers (A, B, and CarryIn). It has two outputs: Sum and CarryOut. The Sum represents the least significant bit of the addition result, while the CarryOut represents the carry-out bit to the next higher order bit.</p>
        <p>Try the Full Adder by toggling the three inputs below. The Sum and Carry outputs will update accordingly:</p>
        <div id="inputA" class="transistor">0</div>
        <div id="inputB" class="transistor">0</div>
        <div id="carryIn" class="transistor">0</div>
        <div>Sum:</div>
        <div id="sum" class="transistor">0</div>
        <div>Carry Out:</div>
        <div id="carryOut" class="transistor">0</div>
    </div>
    <script type="module">
        import init, { full_adder, toggle_transistor } from "./pkg/transistor_game.js";

        document.addEventListener("DOMContentLoaded", function() {
        fetch("sidebar.html")
            .then(response => response.text())
            .then(data => {
                document.getElementById("sidebar-container").innerHTML = data;
            });
        });

        async function run() {
            console.log('Initializing WebAssembly module');
            await init();
            console.log('WebAssembly module initialized');

            const inputA = document.getElementById("inputA");
            const inputB = document.getElementById("inputB");
            const carryIn = document.getElementById("carryIn");
            const sum = document.getElementById("sum");
            const carryOut = document.getElementById("carryOut");

            console.log('Elements:', { inputA, inputB, carryIn, sum, carryOut });

            let stateA = false;
            let stateB = false;
            let stateCarryIn = false;

            function updateOutput() {
                const result = full_adder(stateA, stateB, stateCarryIn);
                const sumResult = result.get_sum();
                const carryOutResult = result.get_carry();

                sum.classList.toggle("on", sumResult);
                sum.textContent = sumResult ? "1" : "0";
                carryOut.classList.toggle("on", carryOutResult);
                carryOut.textContent = carryOutResult ? "1" : "0";
                console.log(`Sum updated: ${sumResult}, Carry Out updated: ${carryOutResult}`);
            }

            if (inputA) {
                inputA.addEventListener("click", () => {
                    console.log('Input A clicked');
                    stateA = toggle_transistor(stateA);
                    inputA.classList.toggle("on", stateA);
                    inputA.textContent = stateA ? "1" : "0";
                    updateOutput();
                });
            } else {
                console.error('inputA element not found');
            }

            if (inputB) {
                inputB.addEventListener("click", () => {
                    console.log('Input B clicked');
                    stateB = toggle_transistor(stateB);
                    inputB.classList.toggle("on", stateB);
                    inputB.textContent = stateB ? "1" : "0";
                    updateOutput();
                });
            } else {
                console.error('inputB element not found');
            }

            if (carryIn) {
                carryIn.addEventListener("click", () => {
                    console.log('Carry In clicked');
                    stateCarryIn = toggle_transistor(stateCarryIn);
                    carryIn.classList.toggle("on", stateCarryIn);
                    carryIn.textContent = stateCarryIn ? "1" : "0";
                    updateOutput();
                });
            } else {
                console.error('carryIn element not found');
            }
        }

        run();
    </script>
</body>
</html>
